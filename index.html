<html>
<head>
  <title>P2</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <script src="https://d3js.org/d3.geo.projection.v2.min.js"></script>
  <style>

  .county {
    fill: lightgrey;
  }

  .countyOutline {
    stroke: white;
    stroke-width: 1px;
    fill: none;
  }


  </style>
</head>

<body>
  <!-- name and netid -->
  <h3>Name: Kevin Lee, NetId: ksl66</h3>
  <h3>Name: Yulu Cao, NetId: yc758</h3>

  <svg id="graph" height="800" width="800" style="margin:20px"></svg>

  <script>
  // Initiation
  const svg = d3.select("#graph");
  const width = svg.attr("width");
  const height = svg.attr("height");
  const margin = { top: 20, right: 20, bottom: 20, left:20};
  const mapWidth = width - margin.left - margin.right;
  const mapHeight = height - margin.top - margin.bottom;
  const map = svg.append("g")
                  .attr("transform","translate("+margin.left+","+margin.top+")");


  const requestData = async () => {
    // // compare with dataset hw6
    // const nyb = await d3.json("../ny_state_biodiversity.json");
    // console.log(nyb);

    // japan topojson
    // const jp = await d3.json("../raw_data/japan.topojson");
    // console.log(jp);
    // var japan = topojson.feature(jp, jp.objects.japan);
    // var japanMesh = topojson.mesh(jp, jp.objects.japan);
    // var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], japan);
    // var path = d3.geoPath().projection(projection);
    //
    // map.selectAll("path.county").data(japan.features)
    //    .join("path")
    //    .attr("class", "county")
    //    .attr("d", path);
    //
    // map.append("path").datum(japanMesh)
    //    .attr("class","countyOutline")
    //    .attr("d", path);

    const kyoto = await d3.json("../kyoto_all.json");
    console.log(kyoto);
    var city = topojson.feature(kyoto, kyoto.objects.kyoto);
    var cityMesh = topojson.mesh(kyoto, kyoto.objects.kyoto);
    var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], city);
    var path = d3.geoPath().projection(projection);

    map.selectAll("path.county").data(city.features)
       .join("path")
       .attr("class", "county")
       .attr("d", path);

    map.append("path").datum(city)
       .attr("class","countyOutline")
       .attr("d", path);


    // load restaurant data
    const restaurants = await d3.json("../kyoto_restaurants_processed.json");
    console.log(restaurants);

    restaurants.forEach( (d, i) => {
    // Use the projection just like a scale to convert from lng/lat to pixels
      d.position = projection([d.Long, d.Lat]);
    });
    console.log(restaurants)
    
    // Draw circles using the positions we just made
    map.selectAll("circle.dot").data(restaurants)
         .join("circle")
         .attr("class","dot")
         .attr("r", 1)
         .attr("fill", "red")
         .attr("opacity", 0.6)
         .attr("cx", d => d.position[0])
         .attr("cy", d => d.position[1]);

  };

  requestData();

  </script>

</body>
</html>
